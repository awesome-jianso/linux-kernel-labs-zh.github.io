<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Infrastructure &mdash; The Linux Kernel  documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="../_static/slides.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    
    
    <link rel="stylesheet" href="../_static/asciinema-player.css" type="text/css" />
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/asciinema-player.js"></script>
    <script type="text/javascript" src="../_static/common.js"></script>
    
    <script type="text/javascript" src="../_static/slides.js"></script>
    <script type="text/javascript" src="../_static/sync.js"></script>
    <script type="text/javascript" src="../_static/controller.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>
    
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="The Linux Kernel  documentation" href="../index.html" />
    <link rel="next" title="Introduction" href="introduction.html" />
    <link rel="prev" title="Virtualization" href="../lectures/virt.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  
<article class="slide level-1" id="infrastructure">

<h1>Infrastructure</h1>

<p>In order to facilitate learning each topic has a hands-on exercises
section which will contain in-depth, incremental clues on how to solve
one or multiple tasks. To focus on a particular issue most of the
tasks will be performed on existing skeleton drivers. Each skeleton
driver has clearly marked sections that needs to be filled in order to
complete the tasks.</p>
<p>The skeleton drivers are generated from full source examples located
in tools/labs/templates. To solve tasks you start by generating the
skeleton drivers, running the <strong>skels</strong> target in <em>tools/labs</em>. To
keep the workspace clean it is recommended to generate the skeletons
for one lab only and clean the workspace before start working on a new
lab. Labs can be selected by using the <strong>LABS</strong> variable:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>tools/labs $ make clean
tools/labs $ <span class="nv">LABS</span><span class="o">=</span>kernel_modules make skels

tools/labs $ ls skels/kernel_modules/
<span class="m">1</span>-2-test-mod  <span class="m">3</span>-error-mod  <span class="m">4</span>-multi-mod  <span class="m">5</span>-oops-mod  <span class="m">6</span>-cmd-mod  <span class="se">\</span>
<span class="m">7</span>-list-proc  <span class="m">8</span>-kprobes  <span class="m">9</span>-kdb
</pre></div>
</div>
<p>You can also use the same variable to generate skeletons for specific
tasks:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>tools/labs $ <span class="nv">LABS</span><span class="o">=</span><span class="s2">&quot;kernel_modules/6-cmd-mod kernel_modules/8-kprobes&quot;</span> make skels

tools/labs$ ls skels/kernel_modules
<span class="m">6</span>-cmd-mod  <span class="m">8</span>-kprobes
</pre></div>
</div>
<p>For each task you may have multiple steps to perform, usually
incremental. These steps are marked in the source code as well as in
the lab exercises with the keyword <em>TODO</em>. If we have multiple steps
to perform they will be prefixed by a number, like <em>TODO1</em>, <em>TODO2</em>,
etc. If no number is used it is assumed to be the one and only
step. If you want to resume a task from a certain step, you can using
the <strong>TODO</strong> variable. The following example will generate the
skeleton with the first <em>TODO</em> step resolved:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>tools/labs $ <span class="nv">TODO</span><span class="o">=</span><span class="m">2</span> <span class="nv">LABS</span><span class="o">=</span><span class="s2">&quot;kernel_modules/8-kprobes&quot;</span> skels
</pre></div>
</div>
<p>Once the skelton drivers are generated you can build them with the
<strong>build</strong> make target:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>tools/labs $ make build
<span class="nb">echo</span> <span class="s2">&quot;# autogenerated, do not edit &quot;</span> &gt; skels/Kbuild
<span class="k">for</span> i in ./kernel_modules/8-kprobes<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="s2">&quot;obj-m += </span><span class="nv">$i</span><span class="s2">/&quot;</span> &gt;&gt; skels/Kbuild<span class="p">;</span> <span class="k">done</span>
make -C /home/tavi/src/linux <span class="nv">M</span><span class="o">=</span>/home/tavi/src/linux/tools/labs/skels <span class="nv">ARCH</span><span class="o">=</span>x86 modules
make<span class="o">[</span><span class="m">1</span><span class="o">]</span>: Entering directory <span class="s1">&#39;/home/tavi/src/linux&#39;</span>
CC <span class="o">[</span>M<span class="o">]</span>  /home/tavi/src/linux/tools/labs/skels/./kernel_modules/8-kprobes/kprobes.o
Building modules, stage <span class="m">2</span>.
MODPOST <span class="m">1</span> modules
CC      /home/tavi/src/linux/tools/labs/skels/./kernel_modules/8-kprobes/kprobes.mod.o
LD <span class="o">[</span>M<span class="o">]</span>  /home/tavi/src/linux/tools/labs/skels/./kernel_modules/8-kprobes/kprobes.ko
make<span class="o">[</span><span class="m">1</span><span class="o">]</span>: Leaving directory <span class="s1">&#39;/home/tavi/src/linux&#39;</span>
</pre></div>
</div>
<p>To copy the drivers to the VM you can use either use ssh or update the
VM image directly using the <strong>copy</strong> target:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>tools/labs $ make copy
...
<span class="s1">&#39;skels/kernel_modules/8-kprobes/kprobes.ko&#39;</span> -&gt; <span class="s1">&#39;/tmp/tmp.4UMKcISmQM/home/root/skels/kernel_modules/8-kprobes/kprobes.ko&#39;</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">The <strong>copy</strong> target will fail if the VM is
running. This is intentional so that we avoid corrupting the
filesystem.</p>
</div>




</article>

</section>

<section id="slide_notes">

</section>

  </body>
</html>